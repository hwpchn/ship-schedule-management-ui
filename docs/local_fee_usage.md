# 本地费用功能使用说明

## 功能概述

本地费用功能允许用户查看、编辑和管理船舶运输过程中的各种本地费用，包括码头费、保安费、文件费等。

## 访问方式

### 1. 通过搜索航期页面
1. 进入 **船期查询** 页面
2. 输入起运港和目的港进行查询
3. 在查询结果中点击 **"本地费用"** 按钮

### 2. 通过船舶详情
1. 在船期查询结果中点击 **"查看详情"**
2. 在船舶详情表格中点击 **"本地费用"** 按钮

## 功能说明

### 查看本地费用

#### 费用信息显示
- **序号**: 费用项目的序列号
- **名称**: 费用类型名称（如：起运港码头费、保安费等）
- **单位**: 计费单位（箱型、票、单等）
- **20GP**: 20尺普通集装箱费用
- **40GP**: 40尺普通集装箱费用  
- **40HQ**: 40尺高柜集装箱费用
- **单票价格**: 按票计算的费用
- **币种**: 费用货币类型（CNY、USD、EUR等）

#### 路线信息
弹窗顶部显示当前查询的航线信息：
- 船舶名称（如有）
- 起运港 → 目的港

### 编辑本地费用

> **权限要求**: 需要 `local_fee.create`、`local_fee.update` 或 `local_fee.edit` 权限

#### 编辑现有费用
1. 点击表格中的字段进行编辑
2. 支持编辑的字段：
   - 名称：费用类型名称
   - 单位：计费单位（下拉选择）
   - 价格字段：20GP、40GP、40HQ、单票价格
   - 币种：货币类型（下拉选择）

#### 添加新费用
1. 点击 **"+ 添加新费用项目"** 按钮
2. 填写费用信息
3. 点击 **"保存全部更改"** 保存

#### 删除费用
1. 点击费用行的 **"删除"** 按钮
2. 确认删除操作

#### 批量保存
1. 编辑多个费用项目后，系统会显示待保存更改提示
2. 点击 **"保存全部更改"** 批量保存所有修改
3. 点击 **"取消更改"** 撤销所有未保存的修改

### 导出功能

#### 导出CSV文件
1. 点击 **"导出费用表"** 按钮
2. 系统自动生成包含以下信息的CSV文件：
   - 文件名格式：`本地费用_[船舶名]_[起运港]-[目的港].csv`
   - 包含所有费用数据

## 权限说明

### 查看权限
- `local_fee.query`: 查询本地费用（推荐给所有业务用户）
- `local_fee.list`: 查看本地费用列表
- `local_fee.detail`: 查看本地费用详情
- `local_fee.view`: 通用查看权限

### 编辑权限
- `local_fee.create`: 创建新的本地费用
- `local_fee.update`: 修改现有本地费用
- `local_fee.delete`: 删除本地费用

### 权限组合建议
- **普通业务用户**: `local_fee.query`
- **业务管理员**: `local_fee.query` + `local_fee.create` + `local_fee.update`
- **系统管理员**: 所有权限

## 操作示例

### 示例1：查看上海到金奈的本地费用
1. 进入船期查询页面
2. 选择起运港：CNSHK（蛇口）
3. 选择目的港：INMAA（金奈）
4. 点击查询
5. 在结果中点击"本地费用"按钮

### 示例2：添加新的费用项目
1. 打开本地费用弹窗
2. 点击"+ 添加新费用项目"
3. 填写信息：
   - 名称：燃油附加费
   - 单位：箱型
   - 20GP：120.00
   - 40GP：240.00
   - 40HQ：240.00
   - 币种：USD
4. 点击"保存全部更改"

### 示例3：修改现有费用
1. 打开本地费用弹窗
2. 点击要修改的价格字段
3. 输入新的价格
4. 点击"保存全部更改"

## 常见问题

### Q: 为什么看不到"编辑"功能？
A: 请检查您的用户权限，编辑功能需要相应的权限。联系管理员分配 `local_fee.create`、`local_fee.update` 等权限。

### Q: 保存时提示"权限不足"？
A: 您的账户没有编辑本地费用的权限，请联系管理员分配相应权限。

### Q: 数据保存后没有显示？
A: 请尝试关闭弹窗重新打开，或刷新页面。如果问题持续，请联系技术支持。

### Q: 导出的文件乱码？
A: 请使用支持UTF-8编码的软件打开CSV文件，如Excel 2016及以上版本。

### Q: 能否批量导入费用数据？
A: 当前版本暂不支持批量导入，此功能在后续版本中会添加。

## 技术支持

如果遇到技术问题或需要权限配置，请联系：
- 系统管理员
- 技术支持团队

## 更新记录

- **2025-01-27**: 完全重构本地费用功能，优化用户体验
- 支持实时编辑和批量保存
- 改进权限控制机制
- 优化数据格式和API接口 